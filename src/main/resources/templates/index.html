<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DnD Map Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="app-layout">
        <!-- Left Sidebar Panel -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="mdc-typography--headline6">DnD Map Viewer</h2>
                <button id="sidebarToggle" class="toggle-btn">
                    <i class="material-icons">chevron_left</i>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Map Selection Section -->
                <div class="control-section">
                    <div class="section-toggle" data-target="map-selection">
                        <i class="material-icons">map</i>
                        <span>Wybór mapy</span>
                        <i class="material-icons toggle-icon">expand_less</i>
                    </div>
                    <div class="section-content expanded" id="map-selection">
                        <div class="map-select-wrapper">
                            <select id="mapSelect" class="map-select">
                                <option value="">-- Wybierz mapę --</option>
                                <option th:each="map : ${maps}" th:value="${map.name}" th:text="${map.name}"></option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Fog Management Section -->
                <div class="control-section">
                    <div class="section-toggle" data-target="fog-management">
                        <i class="material-icons">cloud</i>
                        <span>Zarządzanie mgłą</span>
                        <i class="material-icons toggle-icon">expand_less</i>
                    </div>
                    <div class="section-content expanded" id="fog-management">
                        <div class="fog-controls">
                            <button id="eraseFogBtn" class="mdc-button mdc-button--outlined fog-btn">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">cleaning_services</i>
                                <span class="mdc-button__label">Usuń mgłę</span>
                            </button>
                            <button id="paintFogBtn" class="mdc-button mdc-button--outlined fog-btn">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">brush</i>
                                <span class="mdc-button__label">Maluj mgłę</span>
                            </button>
                            <button id="resetFogBtn" class="mdc-button mdc-button--outlined fog-btn fog-btn--danger">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">restart_alt</i>
                                <span class="mdc-button__label">Reset mgły</span>
                            </button>
                        </div>

                        <div class="grid-area-control">
                            <label for="gridAreaSize">Obszar kratek:</label>
                            <select id="gridAreaSize" class="grid-area-select">
                                <option value="1">1x1</option>
                                <option value="2">2x2</option>
                                <option value="3" selected>3x3</option>
                                <option value="4">4x4</option>
                                <option value="5">5x5</option>
                            </select>
                        </div>

                    </div>
                </div>

                <!-- Characters Section -->
                <div class="control-section">
                    <div class="section-toggle" data-target="characters-management">
                        <i class="material-icons">people</i>
                        <span>Postacie</span>
                        <i class="material-icons toggle-icon">expand_less</i>
                    </div>
                    <div class="section-content expanded" id="characters-management">
                        <div class="character-info">
                            <p class="info-text">
                                <i class="material-icons info-icon">info</i>
                                Kliknij przycisk, następnie kliknij na kratkę. SHIFT+przeciągnij aby przenieść postać.
                            </p>
                        </div>
                        <div class="character-mode-controls">
                            <button id="addPlayerBtn" class="mdc-button mdc-button--outlined character-btn">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">person</i>
                                <span class="mdc-button__label">Dodaj gracza</span>
                            </button>
                            <button id="addEnemyBtn" class="mdc-button mdc-button--outlined character-btn">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">dangerous</i>
                                <span class="mdc-button__label">Dodaj wroga</span>
                            </button>
                            <button id="removeCharacterBtn" class="mdc-button mdc-button--outlined character-btn character-btn--danger">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">delete</i>
                                <span class="mdc-button__label">Usuń postać</span>
                            </button>
                        </div>

                        <div class="character-delete-controls">
                            <button id="removeLastPlayerBtn" class="mdc-button mdc-button--outlined character-btn-small">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">person_remove</i>
                                <span class="mdc-button__label">Usuń ostatniego gracza</span>
                            </button>
                            <button id="removeAllPlayersBtn" class="mdc-button mdc-button--outlined character-btn-small character-btn--danger">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">group_remove</i>
                                <span class="mdc-button__label">Usuń graczy</span>
                            </button>
                            <button id="removeLastEnemyBtn" class="mdc-button mdc-button--outlined character-btn-small">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">remove_circle</i>
                                <span class="mdc-button__label">Usuń ostatniego wroga</span>
                            </button>
                            <button id="removeAllEnemiesBtn" class="mdc-button mdc-button--outlined character-btn-small character-btn--danger">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">clear_all</i>
                                <span class="mdc-button__label">Usuń wrogów</span>
                            </button>
                        </div>

                        <div class="character-color-controls">
                            <div class="color-control">
                                <label for="playerColorPicker">Kolor gracza:</label>
                                <input type="color" id="playerColorPicker" value="#00ff00" class="color-picker">
                            </div>
                            <div class="color-control">
                                <label for="enemyColorPicker">Kolor wroga:</label>
                                <input type="color" id="enemyColorPicker" value="#ff0000" class="color-picker">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Section -->
                <div class="control-section">
                    <div class="section-toggle" data-target="view-settings">
                        <i class="material-icons">visibility</i>
                        <span>Widok</span>
                        <i class="material-icons toggle-icon">expand_more</i>
                    </div>
                    <div class="section-content" id="view-settings">
                        <div class="view-controls">
                            <button id="toggleGridBtn" class="mdc-button mdc-button--outlined">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">grid_on</i>
                                <span class="mdc-button__label">Pokaż/Ukryj siatka</span>
                            </button>
                            <button id="togglePreviewViewportBtn" class="mdc-button mdc-button--outlined">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">visibility</i>
                                <span class="mdc-button__label">Ukryj podgląd</span>
                            </button>
                        </div>

                        <div class="rotation-control">
                            <label>Obrót mapy:</label>
                            <div class="rotation-buttons">
                                <button id="rotateLeftBtn" class="mdc-button mdc-button--outlined rotation-btn">
                                    <span class="mdc-button__ripple"></span>
                                    <i class="material-icons mdc-button__icon">rotate_left</i>
                                    <span class="mdc-button__label">-90°</span>
                                </button>
                                <span id="rotationValue" class="rotation-value">0°</span>
                                <button id="rotateRightBtn" class="mdc-button mdc-button--outlined rotation-btn">
                                    <span class="mdc-button__ripple"></span>
                                    <i class="material-icons mdc-button__icon">rotate_right</i>
                                    <span class="mdc-button__label">+90°</span>
                                </button>
                            </div>
                            <button id="resetRotationBtn" class="mdc-button mdc-button--outlined">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">restart_alt</i>
                                <span class="mdc-button__label">Reset obrotu</span>
                            </button>
                        </div>

                        <div class="grid-color-controls">
                            <div class="color-control">
                                <label for="gridColorPicker">Kolor siatki:</label>
                                <input type="color" id="gridColorPicker" value="#ffffff" class="color-picker">
                            </div>
                        </div>

                        <div class="fog-color-controls">
                            <div class="color-control">
                                <label for="fogColorPickerView">Kolor mgły:</label>
                                <input type="color" id="fogColorPickerView" value="#808080" class="color-picker">
                            </div>
                        </div>

                        <div class="fog-color-controls">
                            <div class="color-control">
                                <label for="previewViewportColorPicker">Kolor ramki podglądu:</label>
                                <input type="color" id="previewViewportColorPicker" value="#ff0000" class="color-picker">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grid Calibration Section -->
                <div class="control-section">
                    <div class="section-toggle" data-target="grid-calibration">
                        <i class="material-icons">grid_on</i>
                        <span>Kalibracja siatki</span>
                        <i class="material-icons toggle-icon">expand_more</i>
                    </div>
                    <div class="section-content" id="grid-calibration">
                        <div class="status-chip">
                            <span id="gridStatus" class="mdc-typography--caption">Siatka: niekalibrowana</span>
                        </div>

                        <div class="calibration-actions">
                            <button id="calibrateGridBtn" class="mdc-button mdc-button--outlined">
                                <span class="mdc-button__ripple"></span>
                                <i class="material-icons mdc-button__icon">grid_on</i>
                                <span class="mdc-button__label">Kalibruj</span>
                            </button>
                        </div>

                        <div class="grid-manual">
                            <div class="manual-inputs">
                                <label class="mdc-text-field mdc-text-field--outlined mdc-text-field--dense">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label">Rozmiar</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input type="number" id="gridSizeInput" min="1" class="mdc-text-field__input" />
                                </label>
                                <label class="mdc-text-field mdc-text-field--outlined mdc-text-field--dense">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label">Offset X</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input type="number" id="gridOffsetXInput" class="mdc-text-field__input" />
                                </label>
                                <label class="mdc-text-field mdc-text-field--outlined mdc-text-field--dense">
                                    <span class="mdc-notched-outline">
                                        <span class="mdc-notched-outline__leading"></span>
                                        <span class="mdc-notched-outline__notch">
                                            <span class="mdc-floating-label">Offset Y</span>
                                        </span>
                                        <span class="mdc-notched-outline__trailing"></span>
                                    </span>
                                    <input type="number" id="gridOffsetYInput" class="mdc-text-field__input" />
                                </label>
                            </div>
                            <div class="manual-actions">
                                <button id="saveGridBtn" class="mdc-button mdc-button--raised">
                                    <span class="mdc-button__ripple"></span>
                                    <i class="material-icons mdc-button__icon">save</i>
                                    <span class="mdc-button__label">Zapisz</span>
                                </button>
                                <button id="clearGridBtn" class="mdc-button mdc-button--outlined manual-btn--danger">
                                    <span class="mdc-button__ripple"></span>
                                    <i class="material-icons mdc-button__icon">delete</i>
                                    <span class="mdc-button__label">Usuń</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Control at Bottom -->
            <div class="sidebar-footer">
                <button id="setPreviewMapBtn" class="mdc-button mdc-button--outlined footer-btn">
                    <span class="mdc-button__ripple"></span>
                    <i class="material-icons mdc-button__icon">visibility</i>
                    <span class="mdc-button__label">Ustaw podgląd</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <div class="left-controls">
                <div class="navigation-controls">
                    <div class="nav-row"><button id="navUpBtn" class="nav-btn" title="Góra">▲</button></div>
                    <div class="nav-row">
                        <button id="navLeftBtn" class="nav-btn" title="Lewo">◀</button>
                        <button id="navCenterBtn" class="nav-btn" title="Wycentruj">⚫</button>
                        <button id="navRightBtn" class="nav-btn" title="Prawo">▶</button>
                    </div>
                    <div class="nav-row"><button id="navDownBtn" class="nav-btn" title="Dół">▼</button></div>
                </div>
                <div class="zoom-controls">
                    <button id="zoomInBtn" class="zoom-btn" title="Powiększ">+</button>
                    <div id="zoomLevel" class="zoom-level">100%</div>
                    <button id="zoomOutBtn" class="zoom-btn" title="Pomniejsz">-</button>
                    <button id="rotatePreviewBtn" class="zoom-btn" title="Obróć podgląd">🔄</button>
                </div>
            </div>
            <div class="map-container" id="mapContainer">
                <div class="map-wrapper" id="mapWrapper">
                    <img id="mapImage" class="map-image hidden" alt="Mapa DnD">
                    <canvas id="gridCanvas" class="fog-layer hidden" style="z-index:5;"></canvas>
                    <canvas id="fogCanvas" class="fog-layer hidden"></canvas>
                    <canvas id="calibrationCanvas" class="fog-layer hidden"></canvas>
                    <canvas id="previewViewportCanvas" class="fog-layer hidden" style="z-index:15;"></canvas>
                    <canvas id="charactersCanvas" class="fog-layer hidden" style="z-index:20;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
