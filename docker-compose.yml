version: '3.8'

services:
  dnd-app:
    # Używamy obrazu z Docker Hub (wspiera AMD64 i ARM64)
    image: mroczas88/dnd-map-viewer:latest
    # Alternatywnie możesz budować lokalnie odkomentowując poniższą linię:
    # build: .
    container_name: dnd-map-viewer
    ports:
      - "8080:8080"
    volumes:
      # JEDEN katalog dla wszystkich danych - łatwo zmapować w Docker
      - ./data:/app/data
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      # Ścieżki do podkatalogów w /app/data
      - DND_MAPS_DIR=/app/data/DnD
      - DND_FOG_DIR=/app/data/fog-states
      - DND_GRID_DIR=/app/data/grid-configs
      - DND_CHARACTERS_DIR=/app/data/characters
      - DND_SETTINGS_DIR=/app/data/settings
      # Java memory settings
      - JAVA_OPTS=-Xmx512m -Xms256m
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/gm"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    networks:
      - dnd-network

networks:
  dnd-network:
    driver: bridge

# Wszystkie dane w JEDNYM katalogu ./data:
# ./data/
#   ├── DnD/              - obrazy map (*.jpg, *.png)
#   ├── fog-states/       - stany mgły (*.json)
#   ├── grid-configs/     - konfiguracje siatki (*_grid.json)
#   ├── characters/       - postacie (*_characters.json)
#   └── settings/         - ustawienia (*_settings.json)
#
# Backup: tar -czf backup.tar.gz ./data
# Restore: tar -xzf backup.tar.gz

